---
layout: nocompress
nav_order: 10
title: "Схема взаимодействия"
parent: "Приём платежей"
date: 2023-10-25 00:00:00 +0300
---

# Схема взаимодействия с Инвойсбокс API v3

В зависимости от типа покупателя, схема взаимодействия системы &laquo;Инвойсбокс&raquo; и Магазина могут отличаться незначительно
в части предоставления отчётных документов. Для покупателя - физического лица, отчётным документом по оплате является фискальный
чек, зарегистрированный в [онлайн кассе](/docs/merchant/fz54/) и ОФД. Для покупателя - юридического лица, отчётными документами может являтся акт,
ТОРГ-12, отчёт о переводе средств, маршрутная квитанция и т.д. Набор необходимых документов и схема их предоставления покупателю
оговаривается на стадии заключения договора между Магазином и системой &laquo;Инвойсбокс&raquo;.

1. [Покупатели - физические лица](#покупатели---физические-лица)
1. [Покупатели - организации и индивидуальные предприниматели](#покупатели---организации-и-индивидуальные-предприниматели)

## Покупатели - физические лица

### Процесс создания заказа и оплаты счёта

<div class="mermaid">
sequenceDiagram
    autonumber
    participant Покупатель
    participant Магазин
    participant Инвойсбокс 
    participant Онлайн касса
    rect rgb(204, 245, 204)
      Покупатель->>Магазин: Создает заказ
      Магазин->>Инвойсбокс: Вызов метода создания заказа
      Инвойсбокс->>Магазин: Идентификатор заказа и ссылка на оплату
      Магазин->>Покупатель: Перенаправление на платёжную страницу
      Покупатель-->>Инвойсбокс: Взаимодействие с платёжной страницей, получение счёта
      Покупатель->>Инвойсбокс: Оплата счёта
      Инвойсбокс->>Покупатель: Перенаправление покупателя на сайт магазина
      Инвойсбокс->>Онлайн касса: Чек "предоплата 100%"
      Инвойсбокс->>Покупатель: Предоставление чека "предоплата 100%"
      Инвойсбокс->>Магазин: Уведомление об успешной оплате
    end
</div>

1. Покупатель оформляет заказ на сайте Магазина и выбирает способ оплаты через систему &laquo;Инвойсбокс&raquo;.
1. Магазин создает в системе &laquo;Инвойсбокс&raquo; заказ [через метод API](/docs/merchant/order/create/).
1. Система возвращает ссылку на платёжную страницу для оплаты заказа.
1. Магазин перенаправляет покупателя по полученной ссылке.
1. Покупатель заполняет необходимые для оплаты сведения и получет счёт для оплаты.
1. Покупатель оплачивает счёт.
1. Система &laquo;Инвойсбокс&raquo; перенаправляет покупателя обратно на сайт Магазина.
1. Система &laquo;Инвойсбокс&raquo; формирует и регистрирует чек "предоплата 100%" в [онлайн кассе](/docs/merchant/fz54/) (при оплате физическим лицом).
1. Система &laquo;Инвойсбокс&raquo; направляет чек "предоплата 100%" покупателю (физическому лицу).
1. Система &laquo;Инвойсбокс&raquo; оповещает Магазин об успешной оплате заказа.

### Процесс отгрузки и оформления чека "полный расчёт"

<div class="mermaid">
sequenceDiagram
    autonumber
    participant Покупатель
    participant Магазин
    participant Инвойсбокс 
    participant Онлайн касса
    rect rgb(204, 245, 245)
      Магазин->>Инвойсбокс: Вызов метода отгрузки по заказу
      Инвойсбокс->>Онлайн касса: Чек "полный расчёт"
      Инвойсбокс->>Покупатель: Предоставление чека "полный расчёт"
    end
</div>


1. В случае, если Магазин оказывает услугу или продаёт товар, Магазин направляет запрос отгрузки в систему &laquo;Инвойсбокс&raquo; по факту оказания услуги или факту отгрузки товара курьерской службой/службе доставки или покупателю. Если услуга оказывается онлайн, отгрузка по заказу может быть установлена автоматически.
1. Система &laquo;Инвойсбокс&raquo; формирует и регистрирует чек "полный расчёт" в [онлайн кассе](/docs/merchant/fz54/) (при оплате физическим лицом).
1. Система &laquo;Инвойсбокс&raquo; направляет чек "полный расчёт" покупателю (физическому лицу).

### Процесс оформления возврата

<div class="mermaid">
sequenceDiagram
    autonumber
    participant Покупатель
    participant Магазин
    participant Инвойсбокс 
    participant Онлайн касса
    rect rgb(204, 204, 255)
      Покупатель->>Магазин: Обращается за возвратом по заказу
      Магазин-->Инвойсбокс: Получение списка позиций в заказе
      Магазин->>Инвойсбокс: Вызов метода оформления возврата
      Инвойсбокс->>Покупатель: Осуществление возврата денежных средств
      Инвойсбокс->>Онлайн касса: Чек "возврат"
      Инвойсбокс->>Покупатель: Предоставление чека "возврат"
    end
</div>

1. Покупатель обращается в Магазин для оформления возврата заказа.
1. Опционально, Магазин запрашивает [через метод API](/docs/merchant/refund/get/) доступные к возврату позиции в заказе.
1. Магазин создает возврат в системе &laquo;Инвойсбокс&raquo; [через метод API](/docs/merchant/refund/create/).
1. Система &laquo;Инвойсбокс&raquo; осуществляет возврат денежных средств покупателю.
1. Система &laquo;Инвойсбокс&raquo; формирует и регистрирует чек "возврат" в [онлайн кассе](/docs/merchant/fz54/) (при оплате физическим лицом).
1. Система &laquo;Инвойсбокс&raquo; направляет чек "возврат" покупателю (физическому лицу).


## Покупатели - организации и индивидуальные предприниматели

### Процесс создания заказа и оплаты счёта

<div class="mermaid">
sequenceDiagram
    autonumber
    participant Покупатель
    participant Магазин
    participant Инвойсбокс 
    rect rgb(204, 245, 204)
      Покупатель->>Магазин: Создает заказ
      Магазин->>Инвойсбокс: Вызов метода создания заказа
      Инвойсбокс->>Магазин: Идентификатор заказа и ссылка на оплату
      Магазин->>Покупатель: Перенаправление на платёжную страницу
      Покупатель-->>Инвойсбокс: Взаимодействие с платёжной страницей, получение счёта
      Покупатель->>Инвойсбокс: Оплата счёта
      Инвойсбокс->>Покупатель: Перенаправление покупателя на сайт магазина
      Инвойсбокс->>Магазин: Уведомление об успешной оплате
    end
</div>

1. Покупатель оформляет заказ на сайте Магазина и выбирает способ оплаты через систему &laquo;Инвойсбокс&raquo;.
1. Магазин создает в системе &laquo;Инвойсбокс&raquo; заказ [через метод API](/docs/merchant/order/create/).
1. Система возвращает ссылку на платёжную страницу для оплаты заказа.
1. Магазин перенаправляет покупателя по полученной ссылке.
1. Покупатель заполняет необходимые для оплаты сведения и получет счёт для оплаты.
1. Покупатель оплачивает счёт.
1. Система &laquo;Инвойсбокс&raquo; перенаправляет покупателя обратно на сайт Магазина.
1. Система &laquo;Инвойсбокс&raquo; оповещает Магазин об успешной оплате заказа.

### Процесс отгрузки и оформления отчётных документов

<div class="mermaid">
sequenceDiagram
    autonumber
    participant Покупатель
    participant Магазин
    participant Инвойсбокс 
    rect rgb(204, 245, 245)
      Магазин->>Инвойсбокс: Вызов метода отгрузки по заказу
      Инвойсбокс->>Покупатель: Предоставление отчётных документов
      Магазин-->>Покупатель: Предоставление отчётных документов (если требуется)
    end
</div>


1. В случае, если Магазин оказывает услугу или продаёт товар, Магазин направляет запрос отгрузки в систему &laquo;Инвойсбокс&raquo; по факту оказания услуги или факту отгрузки товара курьерской службой/службе доставки или покупателю. Если услуга оказывается онлайн, отгрузка по заказу может быть установлена автоматически.
1. Система &laquo;Инвойсбокс&raquo; формирует отчёт о переводе средств, а также дополнительный набор отчётных документов по доверенности от магазина, если требуется. При оказании услуг формируется акт, при продаже товаров - формируется ТОРГ-12. Система &laquo;Инвойсбокс&raquo; направляет пакет отчётных документов покупателю по электронной почте, оригиналы по почте и с помощью ЭДО.
1. Магазин направляет покупателю пакет отчётных документов, если это предусмотрено процессом.

### Процесс оформления возврата

<div class="mermaid">
sequenceDiagram
    autonumber
    participant Покупатель
    participant Магазин
    participant Инвойсбокс 
    rect rgb(204, 204, 255)
      Покупатель->>Магазин: Обращается за возвратом по заказу
      Магазин-->Инвойсбокс: Получение списка позиций в заказе
      Магазин->>Инвойсбокс: Вызов метода оформления возврата
      Инвойсбокс->>Покупатель: Осуществление возврата денежных средств
      Инвойсбокс->>Покупатель: Предоставление отчётных документов
      Магазин-->>Покупатель: Предоставление отчётных документов (если требуется)
    end
</div>

1. Покупатель обращается в Магазин для оформления возврата заказа.
1. Опционально, Магазин запрашивает [через метод API](/docs/merchant/refund/get/) доступные к возврату позиции в заказе.
1. Магазин создает возврат в системе &laquo;Инвойсбокс&raquo; [через метод API](/docs/merchant/refund/create/).
1. Система &laquo;Инвойсбокс&raquo; осуществляет возврат денежных средств покупателю.
1. Система &laquo;Инвойсбокс&raquo; формирует набор отчётных документов по доверенности от магазина, если требуется. При оказании услуг формируется акт, при продаже товаров - формируется ТОРГ-12. Система &laquo;Инвойсбокс&raquo; направляет пакет отчётных документов покупателю по электронной почте, оригиналы по почте и с помощью ЭДО.
1. Магазин направляет покупателю пакет отчётных документов, если это предусмотрено процессом.

---

[Читать далее &raquo;](/docs/merchant/fz54){: .btn .btn-primary .mb-4 .mb-md-0 .mr-2 }
