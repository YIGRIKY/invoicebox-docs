---
layout: default
nav_order: 30
title: "OpenCart 2.x"
parent: "Модули для CMS"
grand_parent: "Приём платежей"
date: 2024-05-14 13:40:00 +0300
---

# Описание модуля OpenCart 2.x

![OpenCart](/assets/images/cms/opencart.svg){: .img-right}

[OpenCart](https://www.opencart.com/)  — платформа электронной коммерции, ориентированная на создание интернет-магазинов.
Является бесплатным свободным программным обеспечением, поддерживаются дополнения - модули и шаблоны.

{: .important }
> В случае, если у вас возникнут сложности при самостоятельной установке модуля и его корректной настройке,
пожалуйста, обратитесь к специалистам [службы поддержки](https://www.invoicebox.ru/ru/contacts/feedback.html).

Для установки и настройки платёжного модуля Инвойсбокс:

1. Пройдите по ссылке к плагину на сайте OpenCart. [OpenCart - Платёжный модуль Инвойсбокс](https://www.opencart.com/index.php?route=marketplace/extension/info&member_token=5a2149467743eb9a98246d974109dc4c&extension_id=43952)

2. Авторизуйтесь или зарегистрируйте новый аккаунт. Это нужно для скачивания плагина.

![Opencart 2](/assets/images/cms/opencart2v/1.png){: .img }


3. Скачайте архив с плагином.

![Opencart 2](/assets/images/cms/opencart2v/2.png){: .img }

**Важно: название архива с модулем должно заканчиваться на .ocmod.zip.**
**Важно: сайт должен работать на версии php не менее 7.3.**
4. В административной панели зайдите в раздел Настройки - Управление магазином - FTP и заполните данные для ftp-доступа к сайту. 

![Opencart 2](/assets/images/cms/opencart2v/3.png){: .img }

5. В административной панели зайдите в раздел Модули/Расширения → Установка расширений и загрузите файл install.ocmod.zip. 

![Opencart 2](/assets/images/cms/opencart2v/4.png){: .img }

6. Перейдите в раздел Модули/Расширения → Модификаторы. Очистите и обновите кэш модификаторов, нажав на соответствующие кнопки в правом верхнем углу экрана. 

![Opencart 2](/assets/images/cms/opencart2v/5.png){: .img }

![Opencart 2](/assets/images/cms/opencart2v/6.jpg){: .img }

7. Заходим в раздел Модули/расширения → Модули/расширения. 

![Opencart 2](/assets/images/cms/opencart2v/7.png){: .img }

8. Открываем селект и выбираем Оплата. 

![Opencart 2](/assets/images/cms/opencart2v/8.png){: .img }

9. Находим Инвойсбокс и нажимаем на кнопку “активировать”. 

![Opencart 2](/assets/images/cms/opencart2v/9.png){: .img }

## Настройка модуля

1. Зайдите в раздел Модули/расширения → Модули/расширения.

![Opencart 2](/assets/images/cms/opencart2v/10.png){: .img }

2. В выпадающем списке выберете "Оплата".

![Opencart 2](/assets/images/cms/opencart2v/11.png){: .img }

3. Найдите модуль “Инвойсбокс” и перейдите в редактирование. 

![Opencart 2](/assets/images/cms/opencart2v/11.png){: .img }

4. Перейдите в раздел "настройка платежей". Выберите версию API, заполните необходимые данные:
- идентификатор магазина (v2, v3 новая и v3 текущая)
- региональный код магазина (v2)
- имя пользователя API (v2)
- пароль API (v2)
- ключ API (v2, v3 новая и v3 текущая)
- токен (v3 новая и v3 текущая)

В пункте 5 будут даны тестовые данные для 2й версии, а в пункте 6 - для 3й версии (новой), для получения данных для 3 версии текущего АПИ рекомендуется написать на почту [c-support@invoicebox.ru](mailto:c-support@invoicebox.ru).

5. Доступы для 2й версии API:
- Поле “Магазин” - вставьте нужное или тестовое значение “207” (если включен тестовый режим)
  ![Opencart 2](/assets/images/cms/opencart2v/12.png){: .img }
- Поле “Региональный код магазина” - введите нужное или тестовое значение “78054” (если включен тестовый режим)
  ![Opencart 2](/assets/images/cms/opencart2v/13.png){: .img }
- Заполните поля “Имя пользователя” и “Пароль”. Данные для теста: логин “78054-API” и пароль “LM936s#3jz0“.
  ![Opencart 2](/assets/images/cms/opencart2v/14.png){: .img }
- Поле “Ключ”. Значение для теста: LdjmgMS1WMS0nAIklbDkvuKT7WxaJIoC.
  ![Opencart 2](/assets/images/cms/opencart2v/15.png){: .img }
- Нажмите кнопку “Сохранить” в правом верхнем углу экрана
- ![Opencart 2](/assets/images/cms/opencart2v/16.png){: .img }
6. Доступы для 3й версии API:
- Поле “Идентификатор магазина”. Тестовое значение: ffffffff-ffff-ffff-ffff-ffffffffffff
  ![Opencart 2](/assets/images/cms/opencart2v/17.png){: .img }
- Поля “Токен” и “API Ключ”.Тестовые значения “b37c4c689295904ed21eee5d9a48d42e” и “098f6bcd4621d373cade4e832627b4f6”
  ![Opencart 2](/assets/images/cms/opencart2v/18.jpg){: .img }
- Нажмите кнопку “Сохранить” в правом верхнем углу экрана
  ![Opencart 2](/assets/images/cms/opencart2v/19.png){: .img }
7. Выберите налоговый режим, в котором работает магазин. См. раздел “настройка налогового режима”.
8. Убедитесь, что заполнены значения полей “Единица измерения” и “Код единицы измерения”. Стандартные значения “шт” и “796”. Индивидуальные значения для каждого товара задаются в атрибутах товара.
   ![Opencart 2](/assets/images/cms/opencart2v/20.png){: .img }
9. Если нужно допускать заказ к оплате только после проверки модератором, выберите режим отложенной оплаты и статус, при переводе заказ в который, пользователю будет посылаться ссылка на оплату. Подробнее - в разделе “Специфические настройки”.
   ![Opencart 2](/assets/images/cms/opencart2v/21.png){: .img }
10. Заполните значения полей SKU  в товарах. Если они будут не заполнены, оплату за товар нельзя будет вернуть. Для этого:
    1. Зайдите в раздел Каталог → Товары и нажмите на редактирование товара.
       ![Opencart 2](/assets/images/cms/opencart2v/22.png){: .img }
    2. Далее зайдите в раздел “Данные” и нажмите кнопку справа “двойная стрелка”.
       ![Opencart 2](/assets/images/cms/opencart2v/23.png){: .img }
    3. Найдите поле “Артикул” и при отсутствии актуальных артикулов заполните строку любыми числами. Главное, чтобы у каждого товара был свой уникальный артикул.
       ![Opencart 2](/assets/images/cms/opencart2v/24.png){: .img }
11. Значения остальных полей описано в разделе “Специфические настройки”.
12. Не забудьте в настройках модуля поставить статус “включено”.


При оформлении заказа обязательно нужно  добавить корректный номер телефона.

Возникшую при оплате ошибку можно узнать в истории заказа в админ-панели.

Настройка налогового режима
В налогах важны три пункта:
показываются они клиенту или нет
ставка НДС
формат цен

Формат цен задается в “Система - Локализация - Валюта”. Для каждой валюты проставьте в поле “количество знаков после запятой” значение 2.

![Opencart 2](/assets/images/cms/opencart2v/25.png){: .img }

Ставка НДС задаётся в меню “Система - Локализация - Налоги - Налоговые ставки”.

![Opencart 2](/assets/images/cms/opencart2v/26.png){: .img }

Допускаются ставки НДС 0%, 10%, 20%. В типе нужно выставить “процент”, а в “ставке” - нужное число. 

![Opencart 2](/assets/images/cms/opencart2v/27.png){: .img }

Показ налогов настраивается в 3х местах: в модуле “Инвойсбокс”, в настройках, в модуле “Учитывать в заказе”.
Корректными являются такие варианты:
1. Налоги уже учтены в стоимости и не показываются клиенту.
- Модуль  “Инвойсбокс”:
   ![Opencart 2](/assets/images/cms/opencart2v/28.png){: .img }
- “Система - Настройки - Опции”:
  ![Opencart 2](/assets/images/cms/opencart2v/29.png){: .img }
- Модули/расширения - Учитывать в заказе/Всего заказов-Отчеты - Налоги / Налоговый отчет:
  ![Opencart 2](/assets/images/cms/opencart2v/30.png){: .img }

2. Налоги считаются поверх указанной стоимости товара и показываются клиенту:
- Модуль  “Инвойсбокс”:
  ![Opencart 2](/assets/images/cms/opencart2v/31.png){: .img }
- Система - Настройки - Опции:
  ![Opencart 2](/assets/images/cms/opencart2v/32.png){: .img }
- Модули/расширения - Учитывать в заказе - Налоги:
  ![Opencart 2](/assets/images/cms/opencart2v/33.png){: .img }

### Обновление модуля

При обновлении модуля необходимо в начале удалить модификатор модуля
![Opencart 2](/assets/images/cms/opencart2v/34.jpg){: .img }

И очистить кеш
![Opencart 2](/assets/images/cms/opencart2v/35.jpg){: .img }

После этого провести ту же процедуру, что и при первой установке модуля

### Специфические настройки

Тестовый режим - включите его для проведения тестовых платежей, при включении этого режима, вы пройдете все шаги в платежном терминале «Инвойсбокс», но деньги с вашей карты списаны не будут.

Статус заказа после оплаты - после успешной оплаты заказа, заказу будет установлен выбранный статус.

Статус заказа после подтверждения - при нажатии на кнопку "Подтвердить" на последнем этапе оформления заказа, заказу будет установлен выбранный статус.

Статус заказа после неудачной оплаты - Если «Инвойсбокс» вернёт покупателя после неудачного платежа, заказу будет установлен выбранный статус.

Статус заказа для отсроченной оплаты - после проверки заказа менеджер магазина выставит данный статус, покупатель будет уведомлен по электронной почте и сможет оплатить заказ. Также, ссылка на оплату появится в личном кабинете покупателя в разделе "Мои заказы".

**БУДЬТЕ ВНИМАТЕЛЬНЫ!** Если данный статус будет совпадать со "статус заказа после подтверждения" - режим отсроченной оплаты будет отключён и покупатели будут перенаправляться на сайт «Инвойсбокс» для оплаты сразу после нажатия на кнопку "Оформить заказ".

Режим отсроченной оплаты - при включённом режиме отсроченной (отложенной) оплаты покупатель сможет оплатить заказ только после проверки заказа менеджером магазина. Если вам необходимо, чтобы у покупателя была возможность произвести оплату сразу после оформления заказа без подтверждения менеджером - не включайте эту опцию.

Название - Название метода оплаты на странице оформления заказа.

Инструкция по оплате - выводится при подтверждении заказа. Если поле не заполнено - инструкция выводиться не будет.

В поле "Тип оплаты" выберите вариант full_prepayment (если он не выбран по умолчанию).

Поле "Тип товара по умолчанию"- выберите тип товара, который будет использоваться по умолчанию. Если на сайте присутствуют разные типы товаров, у каждого товара свой тип можно задать в атрибутах.

Поля “Страна-производитель товара по умолчанию” и “Код страны-производителя товара по умолчанию” : выберите страну-производителя, которая будет использоваться по умолчанию. Если на сайте присутствуют товары из нескольких стран, у каждого товара свою страну можно задать в атрибутах.

Если выбрана третья версия API, есть возможность передавать дополнительные данные (например, бронирование билетов или мест проживания).
Для передачи этих данных понадобится помощь разработчика. Сохранять информацию нужно в таблицу `oc_invoicebox_meta`. Подробнее о формате
передаваемых данных можете узнать в [разделе метаданные](/docs/merchant/order/metadata/).

Причины возникновения ошибок при загрузке:
Проверьте, оканчивается ли архив с модулем на “.ocmod.zip”
Проверьте версию php на сайте. Версия должна быть не менее 7.3.

Причины возникновения ошибок при оплате:
Если при оплате возникает ошибка, в первую очередь стоит зайти в административную панель, в раздел заказов и открыть новый заказ. Чаще всего причина будет указана там.
Проверьте, корректно ли указаны единицы измерения. Они должны быть указаны либо в каждом товаре, либо в настройках модуля (если в товаре нужных атрибутов нет, значения берутся из модуля). Частая ошибка - “шт.” вместо “шт”. Код для “шт” - 796.
Проверьте, корректно ли в товарах указан тип товара в самом товаре. Допустимые значения “commodity” и “service”. Либо оставьте поле пустым, чтобы значение бралось из настроек модуля.
Проверьте, правильно ли выставлены настройки налогов. См. раздел “настройка налогового режима”.
Проверьте, корректно ли заполнены доступы от API.
Проверьте, не включена ли опция “тестовое окружение”, если для магазина в Инвойсбокс не создавалось тестовое окружение. Если вы используете тестовые данные доступа из этой инструкции, настройка  “тестовое окружение” должна быть отключена.
Проверьте в настройках модуля, включен ли он.
Если включен режим отложенной оплаты, убедитесь, что статус заказа для отсроченной оплаты не совпадает со статусом заказа после подтверждения.


Причины возникновения ошибок при возврате:
Если при оплате возникает ошибка, в первую очередь стоит посмотреть в истории заказа - иногда точная ошибка может быть указана там.
Проверьте, что используется та же версия API, что и при оплате заказа (нельзя переключаться со 2й на 3ю и наоборот).
Убедитесь, что общая сумма возврата не превышает допустимую для этого заказа (если по этому заказу уже осуществлялся возврат, остаток будет указан в предупреждении на странице возврата).
Убедитесь, что сумма возврата по каждому товару не больше суммы оплаты по этому товару.
Убедитесь, что у каждого товара заполнено поле SKU (Артикул) - с пустым полем сделать возврат для товара нельзя.

### Часто задаваемые вопросы:

Вопрос: При выборе способа оплаты, заказ исчезает из панели управления магазином, даже если клиент оплатил данный заказ
Ответ: Проверьте корректность указания ссылка уведомления об оплате в личном кабинете системы Инвойсбокс. Заказ отображается в панели управления магазином только в том случае, если система оплаты корректно передала магазину информацию об оплате заказа.

