---
layout: default
nav_order: 12
title: "WordPress"
parent: "Модули для CMS"
grand_parent: "Приём платежей"
---

# Описание модуля

![Wordpress](/assets/images/cms/wordpress_logo.png){: .img-right}

Плагин Wordpress для Woocommerce предоставляет простую возможность подключить ваш интернет-магазин к системе оплаты «Инвойсбокс».
Модуль поддерживает два режима работы - с системой «Инвойсбокс» версии 2, а также с обновлённой версией 3.
Версию вашего подключения уточняйте у вашего персонального менеджера или в службе поддержки системы.

## Установка модуля

1. Зайдите в административную часть вашего сайта, перейдите на страницу «Плагины» → «Добавить новый»;
2. В списке доступных решений найдите модуль «InvoiceBox: Payment module for WooCommerce» ([InvoiceBox, invoicebox payment](https://ru.wordpress.org/plugins/invoicebox-payment-gateway/)), установите и активируйте его.

![Wordpress](/assets/images/cms/wordpress/1.jpg)
![Wordpress](/assets/images/cms/wordpress/2.png)

## Настройка модуля

В административном разделе сайта перейдите на страницу «Woocommerce» → «Настройки» → «Платежи» и нажмите на кнопку «Управление» у метода Invoicebox Payment для физ.лиц и Invoicebox Legal Payment для юр.лиц.

![Wordpress](/assets/images/cms/wordpress/3.png)

В настройках платёжной системы настройте следующие параметры:

1. “Название” и “Описание”. Значения данных полей будут показываться клиенту при выборе способа оплаты.
2. Выберите язык, на котором будет отображаться интерфейс платёжной страницы. Также изменится логотип платежной системы на странице оформления заказа (будет написан на кириллице или латинице)
3. Выберите версию API, которая будет использоваться
4. Для проверки настроек включите тестовый режим и проведите тестовый платёж в интернет-магазине. После успешного тестирования обязательно отключите тестовый режим.
5. В выпадающем списке выберите статус "В обработке". После того, как платежная система пришлёт сообщение об успешном прохождении оплаты, статус заказа изменится на указанный в этом поле (например “в обработке” или “выполнен”)
6. Поле "Email, куда отправлять сообщения об ошибках". Заполните данное поле, если хотите получать оповещения в случае возникновения ошибок.
7. Выберите ставку НДС. Обратите внимание, что если в WooCommerce выключен функционал налогов, то НДС будет рассчитываться по выбранному в этом поле значению. Если функционал налогов включен - значение из настроек Invoicebox будет игнорироваться, а расчёт будет производиться по ставкам из настроек Woocommerce.
8. В поле "Тип оплаты" выберите вариант full_prepayment (в случае, если он не выбран по умолчанию)
9. Поле "Тип товара по умолчанию": выберите тип товара, который будет использоваться по умолчанию. Если на сайте присутствуют разные типы товаров, дополнительный вариант можно указать ниже в графе "Мета-поле, где задан тип для отдельного товара" (см. подробнее в пункте “Настройка мета-полей”)
10. Поле “Единица измерения по умолчанию”": выберите единицу измерения, которая будет использоваться по умолчанию. Если на сайте используются разные единицы измерения, дополнительный вариант можно указать ниже в графе "Мета-поле, где задана единица измерения для отдельного товара" (см. подробнее в пункте “Настройка мета-полей”). Также дополнительно указывается код единицы измерения (если выбран русский язык - проверяется по справочнику ОКЕИ). **Примечание: для русского языка важно точное соответствие значению справочнику ОКЕИ (пример - в единице измерения “шт” не должно быть точки в конце)**.
    ![Wordpress](/assets/images/cms/wordpress/4.png)
11. Поле “Страна-производитель товара по умолчанию”: выберите страну-производителя, которая будет использоваться по умолчанию. Если на сайте присутствуют товары из нескольких стран, дополнительный вариант можно указать ниже в графе "Мета-поле, где задана страна-производитель товара" (см. подробнее в пункте “Настройка мета-полей”).
12. Если выбрана третья версия API, есть возможность передавать дополнительные данные (например, бронирование билетов или мест проживания). Для этого нужно указать мета-поле заказа, из которого плагин будет брать информацию. Подробнее о формате передаваемых данных написано по ссылке https://docs.invoicebox.ru/docs/order/metadata/. Это поле должно создаваться и заполняться “на лету” из кода сразу после создания заказа перед оплатой, поэтому для его настройки может понадобиться помощь разработчика.
13. Далее нужно заполнить данные для доступа к API:

- идентификатор магазина (v2 и v3)
- региональный код магазина (v2)
- имя пользователя API (v2)
- пароль API (v2)
- ключ API  (v2 и v3)
- токен (v3).

**Имя пользователя API и пароль API направляются после активации магазина в системе Инвойсбокс на электронную почту, указанную при регистрации.
Идентификатор магазина, региональный код магазина,  ключ API находятся в личном кабинете Инвойсбокс в разделе "Настройки магазина".
Для теста плагина можно воспользоваться данными специально созданных магазинов для 2й и 3й версии апи (доступы к магазинам различаются).**


## Доступы для 2й версии API
- Поле “Идентификатор магазина” - вписываем нужное значение или тестовое значение “207”, если включен тестовый режим
  ![Wordpress](/assets/images/cms/wordpress/5.png)
- Поле “Региональный код магазина” - вводим нужное значение в поле или тестовое значение “78054”, если включен тестовый режим
  ![Wordpress](/assets/images/cms/wordpress/6.png)
- Поля “Имя пользователя” и “Пароль API”. Данные для теста: логин “78054-API” и пароль “LM936s#3jz0“
  ![Wordpress](/assets/images/cms/wordpress/7.png)
- Поле “Ключ API”. Значение для теста: LdjmgMS1WMS0nAIklbDkvuKT7WxaJIoC
- Нажимаем “Сохранить изменения”
  ![Wordpress](/assets/images/cms/wordpress/8.png)

## Доступы для 3й версии API:
- Поле “Идентификатор магазина”. Тестовое значение: ffffffff-ffff-ffff-ffff-ffffffffffff
- Поля “Токен” и “Ключ API”.Тестовые значения “b37c4c689295904ed21eee5d9a48d42e” и “098f6bcd4621d373cade4e832627b4f6” соответственно
  ![Wordpress](/assets/images/cms/wordpress/9.png)
- Нажимаем “Сохранить изменения”
  ![Wordpress](/assets/images/cms/wordpress/8.png)

**Вы сможете отслеживать ошибки, включив функцию логирования. Данные об операциях и ошибках вносятся в логи WooCommerce (меню - WooCommerce - Статус - Журналы)**

**Чтобы настроить приём платежей от юридических лиц, повторите все шаги для способа оплаты Invoicebox Legal Payment**

Зайдите в свой личный кабинет на Invoicebox и в разделе “Мои магазины - Настройки -  Интеграция API - URL уведомления” заполните настройки:
- Тип уведомления: Оплата/HTTP/Post (HTTP POST запрос с данными оплаты в переменных);
- URL уведомления: http://ВАШ_ДОМЕН/wc-api/wc_invoicebox_gateway

## Настройка мета-полей

Мета-поле используется для установки дополнительных параметров товара (страна-производитель, единица измерения и тип товара и т.д.)
Возможно, сайт уже настроен таким образом, что эти поля в товарах есть (их добавляют некоторые плагины, либо это может быть кастомный код в теме). Об их наличии и том, какие значения записать в настройки плагина Invoicebox, можно уточнить у разработчиков сайта.
Если нужные поля отсутствуют, их можно создать самостоятельно с помощью плагина Advanced Custom Fields :

Далее в инструкции показано, как настроить рекомендуемые к заполнению поля. Обо всех остальных возможностях плагина вы можете прочесть в документации по ссылке [advanced custom fields](https://www.advancedcustomfields.com/resources/)

1. Установите и активируйте плагин Advanced Custom Fields [advanced custom fields](https://ru.wordpress.org/plugins/advanced-custom-fields/)
   ![Wordpress](/assets/images/cms/wordpress/10.png)
2. В меню выберите пункт “Добавить группу полей”
   ![Wordpress](/assets/images/cms/wordpress/11.png)
3. Добавьте новое поле
   ![Wordpress](/assets/images/cms/wordpress/13.png)
4. Произвольно назовите группу полей, а в условиях отображения выберите “Тип записи - равно - Товар”
   ![Wordpress](/assets/images/cms/wordpress/12.png)
   В строке "Имя поля" - введите значение предыдущей строки латиницей (обязательно!). В строке "Тип поля" в выпадающем списке выберите "Текст"
5. Чтобы создать мета-поле "Тип товара", добавьте новое поле, заполните ярлык и имя, а в типе поля выберите “Выбор (select)”..
   ![Wordpress](/assets/images/cms/wordpress/14.png)
    - Далее скопируйте и вставьте в пункт “Варианты” следующий текст:
       - commodity : товар
       - service : услуга
6. Сохраните группу полей.
   ![Wordpress](/assets/images/cms/wordpress/15.png)
7. Перейдите в любой товар в административной панели и убедитесь, что на странице товара появилась вкладка с новыми полями.
   ![Wordpress](/assets/images/cms/wordpress/16.png)
8. Впишите идентификаторы, которые вы задавали в “имени поля” на странице настроек плагина и сохраните настройки.
   ![Wordpress](/assets/images/cms/wordpress/17.png)


## Частые вопросы
1. Что такое мета-поле?
   Мета-поля WordPress (произвольные поля) – это метаданные, которые используются для добавления дополнительной информации, относящихся к редактируемой записи, странице или товару.
2. Нужны ли какие-то дополнительные плагины для работы плагина Invoicebox?
   Да. Для работы требуется плагин [WooCommerce](https://ru.wordpress.org/plugins/woocommerce/). Так же для настройки передачи дополнительных данных в платёжную систему может понадобиться плагин [advanced custom fields](https://ru.wordpress.org/plugins/advanced-custom-fields/)/ (см. подробности в пункте “Настройка мета-полей”).
3. Можно ли изменить время на оплату счёта?
    Да. В настройках платёжной системы есть параметры для изменения времени на оплату
    ![Wordpress](/assets/images/cms/wordpress/18.png)

---

[Проект на github](https://github.com/InvoiceBox/WooCommerce-2)

