---
layout: nocompress
nav_order: 1
title: "Возврат с комиссией/штрафом"
parent: "Работа с возвратом"
grand_parent: "Приём платежей"
---

# Возврат с комиссией/штрафом

Иногда при осуществлении возврата требуется удержать штраф или комиссию за возврат. Такой возврат происходит в два этапа через корректировочный заказ на комиссию/штраф:
- [Формирование возврата](#создание-возврата)
- [Формирование корректировочного заказа](#создание-корректировочного-заказа)

После чего произойдет перерасчёт суммы сформированного возврата из п.1 на сумму корректировочного заказа и покупателю осуществится возврат на эту сумму.

### Процесс оформления возврата через корректировочный заказ

<div class="mermaid">
sequenceDiagram
    autonumber
    participant Покупатель
    participant Магазин
    participant Инвойсбокс 
    participant Онлайн касса
    rect rgb(204, 204, 255)
      Покупатель->>Магазин: Обращается за возвратом по заказу
      Магазин-->Инвойсбокс: Получение списка позиций в заказе
      Магазин->>Инвойсбокс: Вызов метода оформления возврата
      Магазин->>Инвойсбокс: Вызов метода создания корректировочного заказа
      Инвойсбокс->>Покупатель: Осуществление возврата денежных средств
      Инвойсбокс->>Онлайн касса: Чек "ВОЗВРАТ 100%"
      Инвойсбокс->>Покупатель: Предоставление чека "ВОЗВРАТ 100%"
      Инвойсбокс->>Онлайн касса: Чек "ОПЛАТА 100%" по корректировочному заказу
      Инвойсбокс->>Покупатель: Предоставление чека "ОПЛАТА 100%"
    end
</div>

1. Покупатель обращается в Магазин для оформления возврата заказа.
1. Опционально, Магазин запрашивает [через метод API](/docs/merchant/refund/get/) доступные к возврату позиции в заказе.
1. Магазин формирует возврат в системе &laquo;Инвойсбокс&raquo; [через метод API](/docs/merchant/refund/create/).
1. Магазин формирует корректировочный заказ в системе &laquo;Инвойсбокс&raquo; с указанием позиции комиссии или штрафа [через метод API](/docs/merchant/refund/create/).
1. Система &laquo;Инвойсбокс&raquo; осуществляет возврат денежных средств покупателю на сумму возврата за минусом суммы корректировочного заказа.
1. Система &laquo;Инвойсбокс&raquo; формирует и регистрирует чек "ВОЗВРАТ 100%" в [онлайн кассе](/docs/merchant/fz54/) (при оплате физическим лицом).
1. Система &laquo;Инвойсбокс&raquo; направляет чек "ВОЗВРАТ 100%" покупателю (физическому лицу).
1. Система &laquo;Инвойсбокс&raquo; формирует и регистрирует чек "ОПЛАТА 100%" по корректировочному заказу в [онлайн кассе](/docs/merchant/fz54/) (при оплате физическим лицом).
1. Система &laquo;Инвойсбокс&raquo; направляет чек "ОПЛАТА 100%" покупателю (физическому лицу).


### Формирование возврата

Сформируйте возврат со специальным статусом **draft** и получите его **идентификатор** (id) через метод API [создания возврата](/docs/merchant/refund/create/)

### Формирование корректировочного заказа

Сформируйте корректировочный заказ с указанием новых позиций (штрафов, комиссий, сервисных сборов) со ссылкой на возврат из пункта 1. через поле `parentId`,
т.е. укажите в поле `parentId` полученный идентификатор `id` возврата.


Для создания заказа, необходимо вызвать следующий метод API:
- метод: `POST`
- ресурс: `/v3/billing/api/order/correction-order`
- тело запроса - объект [CreateOrderRequest](/docs/merchant/order/create/#createorderrequest)
- тело ответа - объект [OrderResponse](/docs/merchant/order/create/#orderresponse)
- Возможные [ошибки](/docs/dictionary/error/)

