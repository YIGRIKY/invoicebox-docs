---
layout: nocompress
nav_order: 4
title: "Отмена заказа"
parent: "Работа с заказом"
grand_parent: "Приём платежей"
---

# Отмена заказа

Для отмены заказа до момента его полной оплаты, необходимо вызвать следующий метод API:

- метод: `DELETE`
- ресурс: `/v3/billing/api/order/order/:uuid` - где `:uuid` это идентификатор заказа
- тело запроса - отсутствует
- тело ответа - объект [OrderResponse](/docs/merchant/order/create/#orderresponse) со статусом status = `canceled`

Пример запроса:
```
DELETE /v3/billing/api/order/order/c5041a79-24a6-42d1-b0ce-4abb94982cd9
Accept: application/json
User-Agent: MyApp 1.0
Authorization: Bearer b37c4c689295904ed21eee5d9a48d42e
```

В зависимости от сценария использования и настроек магазина, может быть применена разная логика при вызове метода.
По умолчанию, отменить заказ возможно только до момента получения системой Инвойсбокс
информации об отгрузке по заказу. После получения информации об отгрузке, для отмены заказа и возврата средств, пожалуйста,
воспользуйтесь [методом оформления возврата](/docs/merchant/refund). 

{: .important }
> В случае, если оплата заказа подтверждена с использованием гарантийных платёжных инструментов (Обещанный платёж, Гарантийный фонд,
> Овердрафт и т.д.) и у заказа нет информации об успешной отгрузке, отмена заказа инициирует полный возврат гарантийного платежа
> плательщику. Гарантийный платёж и его отмена не будут отражены в реестрах и финансовых отчётах магазина.

### Сценарий отмены заказа без отгрузки

Пример использования метода отмены заказа для осуществления отмены гарантийного платежа в случае невозможности оказать
услугу или поставить товар покупателю. Например, при получении информации об оплате заказа произошла ошибка оформления
купленного билета или на складке не оказалось выбранного товара.

<div class="mermaid">
sequenceDiagram
    autonumber
    participant Покупатель
    participant Магазин
    participant Инвойсбокс 
    rect rgb(204, 245, 204)
      Покупатель->>Магазин: Создает заказ
      Магазин->>Инвойсбокс: Вызов метода создания заказа
      Инвойсбокс->>Магазин: Идентификатор заказа и ссылка на оплату
      Магазин->>Покупатель: Перенаправление на платёжную страницу
      Покупатель-->>Инвойсбокс: Взаимодействие с платёжной страницей, получение счёта
      Покупатель->>Инвойсбокс: Оплата счёта через предавторизацию средств на карте или гарантийный фонд
      Инвойсбокс->>Покупатель: Перенаправление покупателя на сайт магазина
      Инвойсбокс->>Магазин: Уведомление об успешной оплате
      Магазин->>Инвойсбокс: Ошибка оказания услуги/поставки товара, status = shipping_unavailable
      Магазин->>Инвойсбокс: Вызов метода отмены заказа
      Инвойсбокс->>Покупатель: Возврат оплаченных средств
    end
</div>

1. Покупатель оформляет заказ на сайте Магазина и выбирает способ оплаты через систему &laquo;Инвойсбокс&raquo;.
1. Магазин создает в системе &laquo;Инвойсбокс&raquo; заказ [через метод API](/docs/merchant/order/create/).
1. Система возвращает ссылку на платёжную страницу для оплаты заказа.
1. Магазин перенаправляет покупателя по полученной ссылке.
1. Покупатель заполняет необходимые для оплаты сведения и получет счёт для оплаты.
1. Покупатель оплачивает счёт, система Инвойсбокс предавторизует сумму оплаты на карте плательщика или гарантийном фонде.
1. Система &laquo;Инвойсбокс&raquo; перенаправляет покупателя обратно на сайт Магазина.
1. Система &laquo;Инвойсбокс&raquo; [оповещает Магазин](/docs/merchant/notification) об успешной оплате заказа.
1. Магазин отвечает системе &laquo;Инвойсбокс&raquo; на уведомление ошибкой оказания услуги/поставки товара, возвращая статус `shipping_unavailable`
1. Магазин вызывает в системе &laquo;Инвойсбокс&raquo; [метод отмены заказа](/docs/merchant/order/delete/).
1. Если в заказе имеется статус `shipping_unavailable` и предавторизованный платёж, система &laquo;Инвойсбокс&raquo; отменяет оплату и заказ, возвращает средства плательщику. Если в заказе иной статус - возвращается ошибка.


---

[Читать далее &raquo;](/docs/merchant/order/merchant-move){: .btn .btn-primary .mb-4 .mb-md-0 .mr-2 }
